/home/marlesson/anaconda3/envs/triplet-session/lib/python3.6/site-packages/luigi/parameter.py:283: UserWarning: Parameter "load_index_mapping_path" with value "None" is not of type string.
  warnings.warn('Parameter "{}" with value "{}" is not of type string.'.format(param_name, param_value))
/home/marlesson/anaconda3/envs/triplet-session/lib/python3.6/site-packages/luigi/parameter.py:283: UserWarning: Parameter "recommender_module_class" with value "None" is not of type string.
  warnings.warn('Parameter "{}" with value "{}" is not of type string.'.format(param_name, param_value))
2020-11-04 00:07:49,626 : INFO : logging configured by default settings
DEBUG: Checking if MostPopularTraining(project=mercado_livre.config.mercado_livre_interaction, sample_size=-1, minimum_interactions=5, session_test_size=0.1, test_size=0.2, dataset_split_method=column, test_split_type=time, val_size=0.2, n_splits=5, split_index=0, data_frames_preparation_extra_params={"sample_days": 8, "history_window": 10, "column_stratification": "SessionID"}, sampling_strategy=none, balance_fields=[], sampling_proportions={}, use_sampling_in_validation=False, eq_filters={}, neq_filters={}, isin_filters={}, seed=42, observation=Most Popular, load_index_mapping_path=None, negative_proportion=0.0, recommender_extra_params={}, device=cuda, batch_size=500, epochs=100, optimizer=adam, optimizer_params={}, learning_rate=0.001, loss_function=bce, loss_function_params={}, gradient_norm_clipping=0.0, gradient_norm_clipping_type=2, early_stopping_patience=5, early_stopping_min_delta=0.001, monitor_metric=val_loss, monitor_mode=min, generator_workers=0, pin_memory=False, policy_estimator_extra_params={}, sample_size_eval=5000, metrics=["loss"], bandit_policy_class=mars_gym.model.bandit.ModelPolicy, bandit_policy_params={}, recommender_module_class=None) is complete
2020-11-04 00:07:49,629 : DEBUG : Checking if MostPopularTraining(project=mercado_livre.config.mercado_livre_interaction, sample_size=-1, minimum_interactions=5, session_test_size=0.1, test_size=0.2, dataset_split_method=column, test_split_type=time, val_size=0.2, n_splits=5, split_index=0, data_frames_preparation_extra_params={"sample_days": 8, "history_window": 10, "column_stratification": "SessionID"}, sampling_strategy=none, balance_fields=[], sampling_proportions={}, use_sampling_in_validation=False, eq_filters={}, neq_filters={}, isin_filters={}, seed=42, observation=Most Popular, load_index_mapping_path=None, negative_proportion=0.0, recommender_extra_params={}, device=cuda, batch_size=500, epochs=100, optimizer=adam, optimizer_params={}, learning_rate=0.001, loss_function=bce, loss_function_params={}, gradient_norm_clipping=0.0, gradient_norm_clipping_type=2, early_stopping_patience=5, early_stopping_min_delta=0.001, monitor_metric=val_loss, monitor_mode=min, generator_workers=0, pin_memory=False, policy_estimator_extra_params={}, sample_size_eval=5000, metrics=["loss"], bandit_policy_class=mars_gym.model.bandit.ModelPolicy, bandit_policy_params={}, recommender_module_class=None) is complete
/home/marlesson/anaconda3/envs/triplet-session/lib/python3.6/site-packages/luigi/parameter.py:283: UserWarning: Parameter "index_mapping_path" with value "None" is not of type string.
  warnings.warn('Parameter "{}" with value "{}" is not of type string.'.format(param_name, param_value))
DEBUG: Checking if SessionInteractionDataFrame(session_test_size=0.1, test_size=0.2, sample_size=-1, minimum_interactions=5, dataset_split_method=column, column_stratification=SessionID, test_split_type=time, item_column=ItemID, available_arms_column_name=, n_splits=5, split_index=0, val_size=0.2, sampling_strategy=none, balance_fields=[], sampling_proportions={}, use_sampling_in_validation=False, eq_filters={}, neq_filters={}, isin_filters={}, seed=42, sample_days=8, history_window=10, size_available_list=100, days_test=1, index_mapping_path=None) is complete
2020-11-04 00:07:49,636 : DEBUG : Checking if SessionInteractionDataFrame(session_test_size=0.1, test_size=0.2, sample_size=-1, minimum_interactions=5, dataset_split_method=column, column_stratification=SessionID, test_split_type=time, item_column=ItemID, available_arms_column_name=, n_splits=5, split_index=0, val_size=0.2, sampling_strategy=none, balance_fields=[], sampling_proportions={}, use_sampling_in_validation=False, eq_filters={}, neq_filters={}, isin_filters={}, seed=42, sample_days=8, history_window=10, size_available_list=100, days_test=1, index_mapping_path=None) is complete
INFO: Informed scheduler that task   MostPopularTraining____mars_gym_model_b____8b1f0052fc   has status   PENDING
2020-11-04 00:07:49,637 : INFO : Informed scheduler that task   MostPopularTraining____mars_gym_model_b____8b1f0052fc   has status   PENDING
DEBUG: Checking if SessionPrepareDataset(sample_days=8, history_window=10, size_available_list=100, minimum_interactions=5) is complete
2020-11-04 00:07:49,638 : DEBUG : Checking if SessionPrepareDataset(sample_days=8, history_window=10, size_available_list=100, minimum_interactions=5) is complete
INFO: Informed scheduler that task   SessionInteractionDataFrame_____SessionID_6cdc23187f   has status   PENDING
2020-11-04 00:07:49,639 : INFO : Informed scheduler that task   SessionInteractionDataFrame_____SessionID_6cdc23187f   has status   PENDING
DEBUG: Checking if PreProcessSessionDataset() is complete
2020-11-04 00:07:49,640 : DEBUG : Checking if PreProcessSessionDataset() is complete
INFO: Informed scheduler that task   SessionPrepareDataset_10_5_8_99735ee898   has status   PENDING
2020-11-04 00:07:49,641 : INFO : Informed scheduler that task   SessionPrepareDataset_10_5_8_99735ee898   has status   PENDING
INFO: Informed scheduler that task   PreProcessSessionDataset__99914b932b   has status   DONE
2020-11-04 00:07:49,641 : INFO : Informed scheduler that task   PreProcessSessionDataset__99914b932b   has status   DONE
INFO: Done scheduling tasks
2020-11-04 00:07:49,641 : INFO : Done scheduling tasks
INFO: Running Worker with 1 processes
2020-11-04 00:07:49,641 : INFO : Running Worker with 1 processes
DEBUG: Asking scheduler for work...
2020-11-04 00:07:49,641 : DEBUG : Asking scheduler for work...
DEBUG: Pending tasks: 3
2020-11-04 00:07:49,641 : DEBUG : Pending tasks: 3
INFO: [pid 1681835] Worker Worker(salt=572732846, workers=1, host=marlesson-pc, username=marlesson, pid=1681835) running   SessionPrepareDataset(sample_days=8, history_window=10, size_available_list=100, minimum_interactions=5)
2020-11-04 00:07:49,641 : INFO : [pid 1681835] Worker Worker(salt=572732846, workers=1, host=marlesson-pc, username=marlesson, pid=1681835) running   SessionPrepareDataset(sample_days=8, history_window=10, size_available_list=100, minimum_interactions=5)
INFO: Running command: spark-submit --name SessionPrepareDataset --driver-memory 8g /home/marlesson/anaconda3/envs/triplet-session/lib/python3.6/site-packages/luigi/contrib/pyspark_runner.py /tmp/SessionPrepareDatasetrrg2p32k/SessionPrepareDataset.pickle
2020-11-04 00:07:49,666 : INFO : Running command: spark-submit --name SessionPrepareDataset --driver-memory 8g /home/marlesson/anaconda3/envs/triplet-session/lib/python3.6/site-packages/luigi/contrib/pyspark_runner.py /tmp/SessionPrepareDatasetrrg2p32k/SessionPrepareDataset.pickle
INFO: [pid 1681835] Worker Worker(salt=572732846, workers=1, host=marlesson-pc, username=marlesson, pid=1681835) done      SessionPrepareDataset(sample_days=8, history_window=10, size_available_list=100, minimum_interactions=5)
2020-11-04 00:08:56,084 : INFO : [pid 1681835] Worker Worker(salt=572732846, workers=1, host=marlesson-pc, username=marlesson, pid=1681835) done      SessionPrepareDataset(sample_days=8, history_window=10, size_available_list=100, minimum_interactions=5)
DEBUG: 1 running tasks, waiting for next task to finish
2020-11-04 00:08:56,085 : DEBUG : 1 running tasks, waiting for next task to finish
INFO: Informed scheduler that task   SessionPrepareDataset_10_5_8_99735ee898   has status   DONE
2020-11-04 00:08:56,085 : INFO : Informed scheduler that task   SessionPrepareDataset_10_5_8_99735ee898   has status   DONE
DEBUG: Asking scheduler for work...
2020-11-04 00:08:56,085 : DEBUG : Asking scheduler for work...
DEBUG: Pending tasks: 2
2020-11-04 00:08:56,086 : DEBUG : Pending tasks: 2
INFO: [pid 1681835] Worker Worker(salt=572732846, workers=1, host=marlesson-pc, username=marlesson, pid=1681835) running   SessionInteractionDataFrame(session_test_size=0.1, test_size=0.2, sample_size=-1, minimum_interactions=5, dataset_split_method=column, column_stratification=SessionID, test_split_type=time, item_column=ItemID, available_arms_column_name=, n_splits=5, split_index=0, val_size=0.2, sampling_strategy=none, balance_fields=[], sampling_proportions={}, use_sampling_in_validation=False, eq_filters={}, neq_filters={}, isin_filters={}, seed=42, sample_days=8, history_window=10, size_available_list=100, days_test=1, index_mapping_path=None)
2020-11-04 00:08:56,086 : INFO : [pid 1681835] Worker Worker(salt=572732846, workers=1, host=marlesson-pc, username=marlesson, pid=1681835) running   SessionInteractionDataFrame(session_test_size=0.1, test_size=0.2, sample_size=-1, minimum_interactions=5, dataset_split_method=column, column_stratification=SessionID, test_split_type=time, item_column=ItemID, available_arms_column_name=, n_splits=5, split_index=0, val_size=0.2, sampling_strategy=none, balance_fields=[], sampling_proportions={}, use_sampling_in_validation=False, eq_filters={}, neq_filters={}, isin_filters={}, seed=42, sample_days=8, history_window=10, size_available_list=100, days_test=1, index_mapping_path=None)
ERROR: [pid 1681835] Worker Worker(salt=572732846, workers=1, host=marlesson-pc, username=marlesson, pid=1681835) failed    SessionInteractionDataFrame(session_test_size=0.1, test_size=0.2, sample_size=-1, minimum_interactions=5, dataset_split_method=column, column_stratification=SessionID, test_split_type=time, item_column=ItemID, available_arms_column_name=, n_splits=5, split_index=0, val_size=0.2, sampling_strategy=none, balance_fields=[], sampling_proportions={}, use_sampling_in_validation=False, eq_filters={}, neq_filters={}, isin_filters={}, seed=42, sample_days=8, history_window=10, size_available_list=100, days_test=1, index_mapping_path=None)
Traceback (most recent call last):
  File "/home/marlesson/anaconda3/envs/triplet-session/lib/python3.6/site-packages/luigi/worker.py", line 199, in run
    new_deps = self._run_get_new_deps()
  File "/home/marlesson/anaconda3/envs/triplet-session/lib/python3.6/site-packages/luigi/worker.py", line 141, in _run_get_new_deps
    task_gen = self.task.run()
  File "/media/workspace/mars-gym/src/mars_gym/data/task.py", line 207, in run
    self.train_df, self.val_df, self.test_df = self.split_dataset(df)
  File "/media/workspace/mars-gym/src/mars_gym/data/task.py", line 227, in split_dataset
    df, test_size=self.test_size
  File "/media/workspace/triplet_session/mercado_livre/data.py", line 213, in time_train_test_split
    cutoff_date = df[self.timestamp_property].iloc[-1] - pd.Timedelta(days=self.days_test)
  File "/home/marlesson/anaconda3/envs/triplet-session/lib/python3.6/site-packages/pandas/core/indexing.py", line 1424, in __getitem__
    return self._getitem_axis(maybe_callable, axis=axis)
  File "/home/marlesson/anaconda3/envs/triplet-session/lib/python3.6/site-packages/pandas/core/indexing.py", line 2157, in _getitem_axis
    self._validate_integer(key, axis)
  File "/home/marlesson/anaconda3/envs/triplet-session/lib/python3.6/site-packages/pandas/core/indexing.py", line 2088, in _validate_integer
    raise IndexError("single positional indexer is out-of-bounds")
IndexError: single positional indexer is out-of-bounds
2020-11-04 00:08:56,100 : ERROR : [pid 1681835] Worker Worker(salt=572732846, workers=1, host=marlesson-pc, username=marlesson, pid=1681835) failed    SessionInteractionDataFrame(session_test_size=0.1, test_size=0.2, sample_size=-1, minimum_interactions=5, dataset_split_method=column, column_stratification=SessionID, test_split_type=time, item_column=ItemID, available_arms_column_name=, n_splits=5, split_index=0, val_size=0.2, sampling_strategy=none, balance_fields=[], sampling_proportions={}, use_sampling_in_validation=False, eq_filters={}, neq_filters={}, isin_filters={}, seed=42, sample_days=8, history_window=10, size_available_list=100, days_test=1, index_mapping_path=None)
Traceback (most recent call last):
  File "/home/marlesson/anaconda3/envs/triplet-session/lib/python3.6/site-packages/luigi/worker.py", line 199, in run
    new_deps = self._run_get_new_deps()
  File "/home/marlesson/anaconda3/envs/triplet-session/lib/python3.6/site-packages/luigi/worker.py", line 141, in _run_get_new_deps
    task_gen = self.task.run()
  File "/media/workspace/mars-gym/src/mars_gym/data/task.py", line 207, in run
    self.train_df, self.val_df, self.test_df = self.split_dataset(df)
  File "/media/workspace/mars-gym/src/mars_gym/data/task.py", line 227, in split_dataset
    df, test_size=self.test_size
  File "/media/workspace/triplet_session/mercado_livre/data.py", line 213, in time_train_test_split
    cutoff_date = df[self.timestamp_property].iloc[-1] - pd.Timedelta(days=self.days_test)
  File "/home/marlesson/anaconda3/envs/triplet-session/lib/python3.6/site-packages/pandas/core/indexing.py", line 1424, in __getitem__
    return self._getitem_axis(maybe_callable, axis=axis)
  File "/home/marlesson/anaconda3/envs/triplet-session/lib/python3.6/site-packages/pandas/core/indexing.py", line 2157, in _getitem_axis
    self._validate_integer(key, axis)
  File "/home/marlesson/anaconda3/envs/triplet-session/lib/python3.6/site-packages/pandas/core/indexing.py", line 2088, in _validate_integer
    raise IndexError("single positional indexer is out-of-bounds")
IndexError: single positional indexer is out-of-bounds
DEBUG: 1 running tasks, waiting for next task to finish
2020-11-04 00:08:56,103 : DEBUG : 1 running tasks, waiting for next task to finish
INFO: Informed scheduler that task   SessionInteractionDataFrame_____SessionID_6cdc23187f   has status   FAILED
2020-11-04 00:08:56,105 : INFO : Informed scheduler that task   SessionInteractionDataFrame_____SessionID_6cdc23187f   has status   FAILED
DEBUG: Asking scheduler for work...
2020-11-04 00:08:56,105 : DEBUG : Asking scheduler for work...
DEBUG: Done
2020-11-04 00:08:56,106 : DEBUG : Done
DEBUG: There are no more tasks to run at this time
2020-11-04 00:08:56,106 : DEBUG : There are no more tasks to run at this time
DEBUG: There are 2 pending tasks possibly being run by other workers
2020-11-04 00:08:56,106 : DEBUG : There are 2 pending tasks possibly being run by other workers
DEBUG: There are 2 pending tasks unique to this worker
2020-11-04 00:08:56,106 : DEBUG : There are 2 pending tasks unique to this worker
DEBUG: There are 2 pending tasks last scheduled by this worker
2020-11-04 00:08:56,106 : DEBUG : There are 2 pending tasks last scheduled by this worker
INFO: Worker Worker(salt=572732846, workers=1, host=marlesson-pc, username=marlesson, pid=1681835) was stopped. Shutting down Keep-Alive thread
2020-11-04 00:08:56,106 : INFO : Worker Worker(salt=572732846, workers=1, host=marlesson-pc, username=marlesson, pid=1681835) was stopped. Shutting down Keep-Alive thread
INFO: 
===== Luigi Execution Summary =====

Scheduled 4 tasks of which:
* 1 complete ones were encountered:
    - 1 PreProcessSessionDataset(capture_output=True)
* 1 ran successfully:
    - 1 SessionPrepareDataset(...)
* 1 failed:
    - 1 SessionInteractionDataFrame(...)
* 1 were left pending, among these:
    * 1 had failed dependencies:
        - 1 MostPopularTraining(...)

This progress looks :( because there were failed tasks

===== Luigi Execution Summary =====

2020-11-04 00:08:56,109 : INFO : 
===== Luigi Execution Summary =====

Scheduled 4 tasks of which:
* 1 complete ones were encountered:
    - 1 PreProcessSessionDataset(capture_output=True)
* 1 ran successfully:
    - 1 SessionPrepareDataset(...)
* 1 failed:
    - 1 SessionInteractionDataFrame(...)
* 1 were left pending, among these:
    * 1 had failed dependencies:
        - 1 MostPopularTraining(...)

This progress looks :( because there were failed tasks

===== Luigi Execution Summary =====

